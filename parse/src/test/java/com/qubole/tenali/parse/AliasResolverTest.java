package com.qubole.tenali.parse;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.qubole.tenali.parse.config.CommandContext;
import com.qubole.tenali.parse.sql.datamodel.TenaliAstNode;
import com.qubole.tenali.util.SqlCommandTestHelper;
import org.apache.calcite.sql.SqlNode;
import org.junit.Test;

import static org.junit.Assert.assertEquals;


public class AliasResolverTest {

    private String getTransformedString(Object ast) throws Exception {
        ObjectMapper objectMapper = new ObjectMapper();
        String res = objectMapper.writeValueAsString(ast);
        //System.out.println(res);
        return res;
    }

    @Test
    public void testSimpleJoinQuery() throws Exception {
        String command = "use rstore; select tab2.account_id, tab1.tag, tab2.id, user_loc from query_hists tab1 join cluster_nodes  tab2 on tab1.account_id=tab2.account_id where tab2.account_id>0";

        String result = "{\"type\":\"select\",\"where\":{\"type\":\"operator\",\"operator\":\">\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTER_NODES.ACCOUNT_ID\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"join\",\"joinType\":\"INNER\",\"leftNode\":{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS\"},\"rightNode\":{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTER_NODES\"},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTER_NODES.ACCOUNT_ID\"}]}}}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.TAG\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.USER_LOC\"},{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTER_NODES.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTER_NODES.ID\"}]}}";
        CommandContext ctx = SqlCommandTestHelper.parseHive(command);

        CommandContext cctx = ctx.getChild(1);

        TenaliAstNode ast = cctx.getQueryContext().getTenaliAst();
        assertEquals(result, getTransformedString(ast));
    }

    @Test
    public void testComplexJoinQuery1() throws Exception {
        String command = "select s2.acc_id, tag1, s1.id from (select tab1.account_id acc_id, tab1.tag tag1, tab2.id from rstore.query_hists tab1 join rstore.cluster_nodes  tab2 on tab1.account_id=tab2.account_id where tab2.account_id>0) s1 ";

        String result = "{\"type\":\"select\",\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"select\",\"where\":{\"type\":\"operator\",\"operator\":\">\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTER_NODES.ACCOUNT_ID\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"join\",\"joinType\":\"INNER\",\"leftNode\":{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS\"},\"rightNode\":{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTER_NODES\"},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTER_NODES.ACCOUNT_ID\"}]}}}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.TAG\"},{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTER_NODES.ID\"}]}}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.TAG\"},{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTER_NODES.ID\"}]}}";
        CommandContext ctx = SqlCommandTestHelper.parseHive(command);
        CommandContext cctx = ctx.getChild(0);

        TenaliAstNode ast = cctx.getQueryContext().getTenaliAst();
        assertEquals(result, getTransformedString(ast));
    }

    @Test
    public void testComplexJoinQuery2() throws Exception {
        String command = "use rstore; set xyz.oioh.hoee.hebeiw=8988M\n; select s2.acc_id, tag1, s1.id from (select tab1.account_id acc_id, tab1.tag tag1, tab2.id from rstore.query_hists tab1 join rstore.cluster_nodes  tab2 on tab1.account_id=tab2.account_id where tab2.account_id>0) s1 " +
                "join (select id, account_id as acc_id, created_at, deleted_at from rstore.clusters where id>100) s2 on s1.acc_id=s2.acc_id";

        String result="{\"type\":\"select\",\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"join\",\"joinType\":\"INNER\",\"leftNode\":{\"type\":\"select\",\"where\":{\"type\":\"operator\",\"operator\":\">\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTER_NODES.ACCOUNT_ID\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"join\",\"joinType\":\"INNER\",\"leftNode\":{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS\"},\"rightNode\":{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTER_NODES\"},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTER_NODES.ACCOUNT_ID\"}]}}}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.TAG\"},{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTER_NODES.ID\"}]}},\"rightNode\":{\"type\":\"select\",\"where\":{\"type\":\"operator\",\"operator\":\">\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ID\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTERS\"}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.CREATED_AT\"},{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTERS.DELETED_AT\"}]}},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"}]}}}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.TAG\"},{\"type\":\"identifier\",\"name\":\"RSTORE.CLUSTER_NODES.ID\"}]}}";

        CommandContext ctx = SqlCommandTestHelper.parseHive(command);
        CommandContext cctx = ctx.getChild(2);

        TenaliAstNode ast = cctx.getQueryContext().getTenaliAst();
        assertEquals(result, getTransformedString(ast));
    }


    @Test
    public void testComplexJoinQuery3() throws Exception {
        String command = "SELECT language, account_id, count(*) as cnt FROM \n" +
                "(SELECT h.id AS id, h.dt, h.account_id, h.status, language, coalesce(sql, program, cmdline) as sql FROM rstore.query_hists h JOIN rstore.spark_commands s ON h.command_id=s.id and h.dt=s.dt AND h.dt>='2019-02-01' AND status='done') y\n" +
                "LEFT JOIN\n" +
                "(SELECT DISTINCT query_hist_id, sql_app_id, command_id\n" +
                "   FROM (SELECT account_id, command_id, cluster_id, cluster_inst_id, json_extract(event_data,'$.executedQueryInfo.applicationId') as sql_app_id,  \n" +
                "\t\t json_extract(event_data,'$.executedQueryInfo.queryhistId') as query_hist_id, json_extract(event_data,'$.executedQueryInfo.status') AS status, json_extract(event_data,'$.executedQueryInfo.timeTakenMs') as time_taken FROM processed_v2.spark WHERE event_date>='2019-02-01' AND event_type='CLUSTER.SPARK.METRICS.SQL')s\n" +
                "    LEFT JOIN\n" +
                "    (SELECT json_extract(event_data,'$.id') AS metric_app_id FROM processed_v2.spark WHERE event_date>='2019-02-01' AND \n" +
                "     event_type='CLUSTER.SPARK.METRICS') t\n" +
                "    ON s.sql_app_id = t.metric_app_id) x\n" +
                "ON x.query_hist_id = y.id\n" +
                "WHERE query_hist_id is not NULL and sql is not null and length(sql)>50\n" +
                "group by 1, 2\n" +
                "order by 3 desc";


        String result = "{\"type\":\"select\",\"where\":{\"type\":\"operator\",\"operator\":\"AND\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"AND\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"IS NOT NULL\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"JSON_EXTRACT\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.EVENT_DATA\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}}]}},{\"type\":\"function\",\"functionName\":\"IS NOT NULL\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"COALESCE\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.SPARK_COMMANDS.SQL\"},{\"type\":\"identifier\",\"name\":\"RSTORE.SPARK_COMMANDS.PROGRAM\"},{\"type\":\"identifier\",\"name\":\"RSTORE.SPARK_COMMANDS.CMDLINE\"}]}}]}}]}},{\"type\":\"operator\",\"operator\":\">\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"LENGTH\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"COALESCE\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.SPARK_COMMANDS.SQL\"},{\"type\":\"identifier\",\"name\":\"RSTORE.SPARK_COMMANDS.PROGRAM\"},{\"type\":\"identifier\",\"name\":\"RSTORE.SPARK_COMMANDS.CMDLINE\"}]}}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}}]}},\"orderBy\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"COUNT\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"*\"}]}}]},\"groupBy\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.SPARK_COMMANDS.LANGUAGE\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"}]},\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"join\",\"joinType\":\"LEFT\",\"leftNode\":{\"type\":\"select\",\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"join\",\"joinType\":\"INNER\",\"leftNode\":{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS\"},\"rightNode\":{\"type\":\"identifier\",\"name\":\"RSTORE.SPARK_COMMANDS\"},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"AND\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"AND\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"AND\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.COMMAND_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.SPARK_COMMANDS.ID\"}]}},{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.DT\"},{\"type\":\"identifier\",\"name\":\"RSTORE.SPARK_COMMANDS.DT\"}]}}]}},{\"type\":\"operator\",\"operator\":\">=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.DT\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}}]}},{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.STATUS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}}]}}}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.DT\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.STATUS\"},{\"type\":\"function\",\"functionName\":\"COALESCE\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.SPARK_COMMANDS.SQL\"},{\"type\":\"identifier\",\"name\":\"RSTORE.SPARK_COMMANDS.PROGRAM\"},{\"type\":\"identifier\",\"name\":\"RSTORE.SPARK_COMMANDS.CMDLINE\"}]}},{\"type\":\"identifier\",\"name\":\"RSTORE.SPARK_COMMANDS.LANGUAGE\"}]}},\"rightNode\":{\"type\":\"select\",\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"join\",\"joinType\":\"LEFT\",\"leftNode\":{\"type\":\"select\",\"where\":{\"type\":\"operator\",\"operator\":\"AND\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\">=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.EVENT_DATE\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.EVENT_TYPE\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}}]}},\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK\"}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.COMMAND_ID\"},{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.CLUSTER_ID\"},{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.CLUSTER_INST_ID\"},{\"type\":\"function\",\"functionName\":\"JSON_EXTRACT\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.EVENT_DATA\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"function\",\"functionName\":\"JSON_EXTRACT\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.EVENT_DATA\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"function\",\"functionName\":\"JSON_EXTRACT\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.EVENT_DATA\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"function\",\"functionName\":\"JSON_EXTRACT\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.EVENT_DATA\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}}]}},\"rightNode\":{\"type\":\"select\",\"where\":{\"type\":\"operator\",\"operator\":\"AND\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\">=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.EVENT_DATE\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.EVENT_TYPE\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}}]}},\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK\"}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"JSON_EXTRACT\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.EVENT_DATA\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}}]}},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"JSON_EXTRACT\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.EVENT_DATA\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"function\",\"functionName\":\"JSON_EXTRACT\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.EVENT_DATA\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}}]}}}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"JSON_EXTRACT\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.EVENT_DATA\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"function\",\"functionName\":\"JSON_EXTRACT\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.EVENT_DATA\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.COMMAND_ID\"}]},\"keywords\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"DISTINCT\"}]}},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"JSON_EXTRACT\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"PROCESSED_V2.SPARK.EVENT_DATA\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ID\"}]}}}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.SPARK_COMMANDS.LANGUAGE\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"operator\",\"operator\":\"COUNT\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"*\"}]}}]}}";

        CommandContext ctx = SqlCommandTestHelper.parseHive(command);
        CommandContext cctx = ctx.getChild(0);

        TenaliAstNode ast = cctx.getQueryContext().getTenaliAst();
        assertEquals(result, getTransformedString(ast));
    }


    @Test
    public void testComplexCTASQuery() throws Exception {
        String command = "create table dw_temp_swap.transactions  stored as orc   as Select lt.loan_id , lt.credit_line_id , " +
                "case when lt.credit_line_id is not null then 'credit_line'     when prod_type.hsa_uuid is not null then 'hard_secured'     " +
                "when prod_type.ara_uuid is not null then 'auto_refi'     else 'unsecured' end as product_type, lt.id as loan_task_id , lt.status as loan_task_status , " +
                "lt.type as loan_task_type , cast(lt.eff_date as date) as loan_task_eff_date , from_utc_timestamp(lt.created_at, 'CST') as loan_task_created_time , " +
                "from_utc_timestamp(lt.updated_at, 'CST') as loan_task_updated_time , lt2.id as parent_loan_task_id , lt2.type as parent_loan_task_type , " +
                "case when lt.type in ('take_payment', 'add_credit_breakdown') and lt.status = 'completed' then 1 else 0 end as completed_transaction , " +
                "pt.id as payment_transaction_id , pt.status as payment_transaction_status , cast(pt.eff_date as date) as pt_eff_date , " +
                "from_utc_timestamp(pt.created_at, 'CST') as payment_transaction_created_time , pt.debit_account as debit_account , pt.credit_account as credit_account , " +
                "round(pt.amount_cents / 100.0, 2) as payment_transaction_amount , cast(ad.prev_biz_day as date) as payment_transaction_eff_prev_biz_date , cast(ad.next_biz_day as date) as payment_transaction_eff_next_biz_date , " +
                "payments.method as payment_method , payments2.method as parent_payment_method , cast(coalesce(payments.eff_date, payments2.eff_date) as timestamp) as payment_eff_date , payments.installment_id , " +
                "round(pt.amount_cents/100.0,2)*acc.is_exp_fees_late_credit as is_exp_fees_late_credit , round(pt.amount_cents/100.0,2)*acc.is_exp_fees_nsf_credit as is_exp_fees_nsf_credit , " +
                "round(pt.amount_cents/100.0,2)*acc.is_exp_interest_credit as is_exp_interest_credit , round(pt.amount_cents/100.0,2)*acc.is_exp_principal_credit as is_exp_principal_credit , " +
                "round(pt.amount_cents/100.0,2)*acc.is_exp_refunds as is_exp_refunds , round(pt.amount_cents/100.0,2)*acc.is_exp_unearned_cash_credit as is_exp_unearned_cash_credit , " +
                "round(pt.amount_cents/100.0,2)*acc.is_rev_admin_fee as is_rev_admin_fee , round(pt.amount_cents/100.0,2)*acc.is_rev_fees_late as is_rev_fees_late , round(pt.amount_cents/100.0,2)*acc.is_rev_fees_nsf as is_rev_fees_nsf , " +
                "round(pt.amount_cents/100.0,2)*acc.bank_is_rev_admin_fee as bank_is_rev_admin_fee , round(pt.amount_cents/100.0,2)*acc.is_exp_bank_fee as is_exp_bank_fee , round(pt.amount_cents/100.0,2)*acc.is_exp_bank_interest as is_exp_bank_interest, " +
                "round(pt.amount_cents/100.0,2)*acc.bs_a_fees_late_ar as bs_a_fees_late_ar , round(pt.amount_cents/100.0,2)*acc.bs_a_fees_nsf_ar as bs_a_fees_nsf_ar , round(pt.amount_cents/100.0,2)*acc.bs_a_interest_ar as bs_a_interest_ar , " +
                "round(pt.amount_cents/100.0,2)*acc.bs_a_principal_ar as bs_a_principal_ar , round(pt.amount_cents/100.0,2)*acc.bs_l_refunds_escrow as bs_l_refunds_escrow , round(pt.amount_cents/100.0,2)*acc.bs_l_refunds_escrow_fees_late as bs_l_refunds_escrow_fees_late , " +
                "round(pt.amount_cents/100.0,2)*acc.bs_l_refunds_escrow_fees_nsf as bs_l_refunds_escrow_fees_nsf , round(pt.amount_cents/100.0,2)*acc.bs_l_refunds_escrow_general as bs_l_refunds_escrow_general , round(pt.amount_cents/100.0,2)*acc.bs_l_refunds_escrow_interest as bs_l_refunds_escrow_interest , " +
                "round(pt.amount_cents/100.0,2)*acc.bs_l_refunds_escrow_principal as bs_l_refunds_escrow_principal , round(pt.amount_cents/100.0,2)*acc.bs_l_refunds_escrow_unearned_cash as bs_l_refunds_escrow_unearned_cash , round(pt.amount_cents/100.0,2)*acc.bs_l_refunds_payable as bs_l_refunds_payable , " +
                "round(pt.amount_cents/100.0,2)*acc.bs_l_unearned_cash as bs_l_unearned_cash , round(pt.amount_cents/100.0,2)*acc.bank_bs_a_principal_ar as bank_bs_a_principal_ar , round(pt.amount_cents/100.0,2)*acc.bs_a_transaction_fee as bs_a_transaction_fee , " +
                "round(pt.amount_cents/100.0,2)*acc.cf_fees_late_refi_payoff as cf_fees_late_refi_payoff , round(pt.amount_cents/100.0,2)*acc.cf_fees_late_take as cf_fees_late_take , round(pt.amount_cents/100.0,2)*acc.cf_fees_nsf_refi_payoff as cf_fees_nsf_refi_payoff , round(pt.amount_cents/100.0,2)*acc.cf_fees_nsf_take as cf_fees_nsf_take , " +
                "round(pt.amount_cents/100.0,2)*acc.cf_interest_refi_payoff as cf_interest_refi_payoff , round(pt.amount_cents/100.0,2)*acc.cf_interest_take as cf_interest_take , round(pt.amount_cents/100.0,2)*acc.cf_issue as cf_issue , round(pt.amount_cents/100.0,2)*acc.cf_issue_purchase as cf_issue_purchase , " +
                "round(pt.amount_cents/100.0,2)*acc.cf_issue_refi as cf_issue_refi , round(pt.amount_cents/100.0,2)*acc.cf_issue_refi_purchase as cf_issue_refi_purchase , round(pt.amount_cents/100.0,2)*acc.cf_net_admin_fee_take as cf_net_admin_fee_take , round(pt.amount_cents/100.0,2)*acc.cf_principal_refi_payoff as cf_principal_refi_payoff , " +
                "round(pt.amount_cents/100.0,2)*acc.cf_principal_take as cf_principal_take , round(pt.amount_cents/100.0,2)*acc.cf_refunds_pay as cf_refunds_pay , round(pt.amount_cents/100.0,2)*acc.cf_unearned_cash_refi_payoff as cf_unearned_cash_refi_payoff , round(pt.amount_cents/100.0,2)*acc.cf_unearned_cash_take as cf_unearned_cash_take , " +
                "round(pt.amount_cents/100.0,2)*acc.bank_cf_issue as bank_cf_issue , round(pt.amount_cents/100.0,2)*acc.bank_cf_issue_refi as bank_cf_issue_refi , round(pt.amount_cents/100.0,2)*acc.bank_cf_principal_transfer as bank_cf_principal_transfer , round(pt.amount_cents/100.0,2)*acc.cf_bank_fee_pay as cf_bank_fee_pay , " +
                "round(pt.amount_cents/100.0,2)*acc.cf_bank_interest_pay as cf_bank_interest_pay , round(pt.amount_cents/100.0,2)*acc.principal_collected as principal_collected , round(pt.amount_cents/100.0,2)*acc.interest_collected as interest_collected , round(pt.amount_cents/100.0,2)*acc.nsf_fees_collected as nsf_fees_collected , " +
                "round(pt.amount_cents/100.0,2)*acc.late_fees_collected as late_fees_collected , round(pt.amount_cents/100.0,2)*acc.unearned_cash_collected as unearned_cash_collected , round(pt.amount_cents/100.0,2)*acc.general_refund_collected as general_refund_collected , acc.is_credit = 1 as is_credit, " +
                "case when lt.type = 'book_interest' then round(pt.amount_cents/100.0,2) else 0.00 end as interest_booked From avant_basic.payment_transactions pt Join avant_basic.loan_tasks lt on lt.id = pt.loan_task_id Left Join avant_basic.loan_tasks lt2 on lt2.id = lt.parent_loan_task_id Left Join avant_basic.account_date ad on ad.day = pt.eff_date " +
                "Left Join dw_ref.financial_statement_indicators acc on acc.loan_task_type = lt.type   and pt.debit_account = acc.debit_account   and pt.credit_account = acc.credit_account Left Join (   Select id, method, loan_task_id, eff_date, created_at, installment_id, row_number() OVER (PARTITION BY loan_task_id ORDER BY created_at) as row_num   " +
                "From avant_basic.payments   ) payments on lt.id = payments.loan_task_id and payments.row_num = 1 Left Join (   Select id, method, loan_task_id, eff_date, created_at, installment_id, row_number() OVER (PARTITION BY loan_task_id ORDER BY created_at) as row_num   From avant_basic.payments   ) payments2 on lt.parent_loan_task_id = payments2.loan_task_id " +
                "and payments2.row_num = 1 Left Join (   Select l.id as loan_id, hsa.uuid as hsa_uuid, ara.uuid as ara_uuid, row_number() over (partition by l.id) as row_num   From avant_basic.loans l   Left Join avant_basic.customer_applications ca on ca.id = l.customer_application_id   Left Join avant_basic.hard_secured_attempts hsa on hsa.customer_application_uuid = ca.uuid   " +
                "Left Join avant_basic.auto_refinance_attempts ara on ara.customer_application_uuid = ca.uuid   ) prod_type on prod_type.loan_id = lt.loan_id and prod_type.row_num = 1 Where pt.status != 'cancelled'\n";

        String result = "{\"type\":\"ddl\",\"ddlToken\":\"TOK_CREATETABLE\",\"selectNode\":{\"type\":\"select\",\"where\":{\"type\":\"operator\",\"operator\":\"!=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.STATUS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"join\",\"joinType\":\"LEFT\",\"leftNode\":{\"type\":\"join\",\"joinType\":\"LEFT\",\"leftNode\":{\"type\":\"join\",\"joinType\":\"LEFT\",\"leftNode\":{\"type\":\"join\",\"joinType\":\"LEFT\",\"leftNode\":{\"type\":\"join\",\"joinType\":\"LEFT\",\"leftNode\":{\"type\":\"join\",\"joinType\":\"LEFT\",\"leftNode\":{\"type\":\"join\",\"joinType\":\"INNER\",\"leftNode\":{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS\"},\"rightNode\":{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS\"},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.ID\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.LOAN_TASK_ID\"}]}}},\"rightNode\":{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS\"},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.ID\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.PARENT_LOAN_TASK_ID\"}]}}},\"rightNode\":{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.ACCOUNT_DATE\"},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.ACCOUNT_DATE.DAY\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.EFF_DATE\"}]}}},\"rightNode\":{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS\"},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"AND\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"AND\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.LOAN_TASK_TYPE\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.TYPE\"}]}},{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.DEBIT_ACCOUNT\"},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.DEBIT_ACCOUNT\"}]}}]}},{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.CREDIT_ACCOUNT\"},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CREDIT_ACCOUNT\"}]}}]}}},\"rightNode\":{\"type\":\"select\",\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENTS\"}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROW_NUMBER\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"WINDOWSPEC\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"TOK_DISTRIBUTEBY\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"LOAN_TASK_ID\"}]}},{\"type\":\"operator\",\"operator\":\"TOK_ORDERBY\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"TOK_TABSORTCOLNAMEASC\"}]}}]}}]}},{\"type\":\"identifier\",\"name\":\"CREATED_AT\"},{\"type\":\"identifier\",\"name\":\"METHOD\"},{\"type\":\"identifier\",\"name\":\"ID\"},{\"type\":\"identifier\",\"name\":\"EFF_DATE\"},{\"type\":\"identifier\",\"name\":\"LOAN_TASK_ID\"},{\"type\":\"identifier\",\"name\":\"INSTALLMENT_ID\"}]}},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"AND\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.ID\"},{\"type\":\"identifier\",\"name\":\"LOAN_TASK_ID\"}]}},{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROW_NUMBER\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"WINDOWSPEC\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"TOK_DISTRIBUTEBY\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"LOAN_TASK_ID\"}]}},{\"type\":\"operator\",\"operator\":\"TOK_ORDERBY\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"TOK_TABSORTCOLNAMEASC\"}]}}]}}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}}]}}},\"rightNode\":{\"type\":\"select\",\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENTS\"}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROW_NUMBER\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"WINDOWSPEC\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"TOK_DISTRIBUTEBY\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"LOAN_TASK_ID\"}]}},{\"type\":\"operator\",\"operator\":\"TOK_ORDERBY\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"TOK_TABSORTCOLNAMEASC\"}]}}]}}]}},{\"type\":\"identifier\",\"name\":\"CREATED_AT\"},{\"type\":\"identifier\",\"name\":\"METHOD\"},{\"type\":\"identifier\",\"name\":\"ID\"},{\"type\":\"identifier\",\"name\":\"EFF_DATE\"},{\"type\":\"identifier\",\"name\":\"LOAN_TASK_ID\"},{\"type\":\"identifier\",\"name\":\"INSTALLMENT_ID\"}]}},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"AND\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.PARENT_LOAN_TASK_ID\"},{\"type\":\"identifier\",\"name\":\"LOAN_TASK_ID\"}]}},{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROW_NUMBER\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"WINDOWSPEC\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"TOK_DISTRIBUTEBY\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"LOAN_TASK_ID\"}]}},{\"type\":\"operator\",\"operator\":\"TOK_ORDERBY\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"TOK_TABSORTCOLNAMEASC\"}]}}]}}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}}]}}},\"rightNode\":{\"type\":\"select\",\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"join\",\"joinType\":\"LEFT\",\"leftNode\":{\"type\":\"join\",\"joinType\":\"LEFT\",\"leftNode\":{\"type\":\"join\",\"joinType\":\"LEFT\",\"leftNode\":{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOANS\"},\"rightNode\":{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.CUSTOMER_APPLICATIONS\"},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.CUSTOMER_APPLICATIONS.ID\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOANS.CUSTOMER_APPLICATION_ID\"}]}}},\"rightNode\":{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.HARD_SECURED_ATTEMPTS\"},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.HARD_SECURED_ATTEMPTS.CUSTOMER_APPLICATION_UUID\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.CUSTOMER_APPLICATIONS.UUID\"}]}}},\"rightNode\":{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.AUTO_REFINANCE_ATTEMPTS\"},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.AUTO_REFINANCE_ATTEMPTS.CUSTOMER_APPLICATION_UUID\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.CUSTOMER_APPLICATIONS.UUID\"}]}}}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROW_NUMBER\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"WINDOWSPEC\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"TOK_DISTRIBUTEBY\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOANS.ID\"}]}}]}}]}},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOANS.ID\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.HARD_SECURED_ATTEMPTS.UUID\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.AUTO_REFINANCE_ATTEMPTS.UUID\"}]}},\"joinCondition\":{\"type\":\"operator\",\"operator\":\"AND\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOANS.ID\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOANS.ID\"}]}},{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROW_NUMBER\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"WINDOWSPEC\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"TOK_DISTRIBUTEBY\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOANS.ID\"}]}}]}}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}}]}}}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOANS.ID\"},{\"type\":\"function\",\"functionName\":\"WHEN\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"IS NOT NULL\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.CREDIT_LINE_ID\"}]}},{\"type\":\"function\",\"functionName\":\"IS NOT NULL\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.HARD_SECURED_ATTEMPTS.UUID\"}]}},{\"type\":\"function\",\"functionName\":\"IS NOT NULL\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.AUTO_REFINANCE_ATTEMPTS.UUID\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"function\",\"functionName\":\"TOK_DATE\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.EFF_DATE\"}]}},{\"type\":\"function\",\"functionName\":\"FROM_UTC_TIMESTAMP\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.CREATED_AT\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"function\",\"functionName\":\"FROM_UTC_TIMESTAMP\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.UPDATED_AT\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"function\",\"functionName\":\"WHEN\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"AND\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"IN\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.TYPE\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.STATUS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.ID\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.STATUS\"},{\"type\":\"function\",\"functionName\":\"TOK_DATE\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.EFF_DATE\"}]}},{\"type\":\"function\",\"functionName\":\"FROM_UTC_TIMESTAMP\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.CREATED_AT\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.DEBIT_ACCOUNT\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.CREDIT_ACCOUNT\"},{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"function\",\"functionName\":\"TOK_DATE\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.ACCOUNT_DATE.PREV_BIZ_DAY\"}]}},{\"type\":\"function\",\"functionName\":\"TOK_DATE\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.ACCOUNT_DATE.NEXT_BIZ_DAY\"}]}},{\"type\":\"function\",\"functionName\":\"TOK_TIMESTAMP\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"COALESCE\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"EFF_DATE\"},{\"type\":\"identifier\",\"name\":\"EFF_DATE\"}]}}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.IS_EXP_FEES_LATE_CREDIT\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.IS_EXP_FEES_NSF_CREDIT\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.IS_EXP_INTEREST_CREDIT\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.IS_EXP_PRINCIPAL_CREDIT\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.IS_EXP_REFUNDS\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.IS_EXP_UNEARNED_CASH_CREDIT\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.IS_REV_ADMIN_FEE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.IS_REV_FEES_LATE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.IS_REV_FEES_NSF\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BANK_IS_REV_ADMIN_FEE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.IS_EXP_BANK_FEE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.IS_EXP_BANK_INTEREST\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BS_A_FEES_LATE_AR\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BS_A_FEES_NSF_AR\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BS_A_INTEREST_AR\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BS_A_PRINCIPAL_AR\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BS_L_REFUNDS_ESCROW\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BS_L_REFUNDS_ESCROW_FEES_LATE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BS_L_REFUNDS_ESCROW_FEES_NSF\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BS_L_REFUNDS_ESCROW_GENERAL\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BS_L_REFUNDS_ESCROW_INTEREST\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BS_L_REFUNDS_ESCROW_PRINCIPAL\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BS_L_REFUNDS_ESCROW_UNEARNED_CASH\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BS_L_REFUNDS_PAYABLE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BS_L_UNEARNED_CASH\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BANK_BS_A_PRINCIPAL_AR\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BS_A_TRANSACTION_FEE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_FEES_LATE_REFI_PAYOFF\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_FEES_LATE_TAKE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_FEES_NSF_REFI_PAYOFF\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_FEES_NSF_TAKE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_INTEREST_REFI_PAYOFF\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_INTEREST_TAKE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_ISSUE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_ISSUE_PURCHASE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_ISSUE_REFI\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_ISSUE_REFI_PURCHASE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_NET_ADMIN_FEE_TAKE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_PRINCIPAL_REFI_PAYOFF\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_PRINCIPAL_TAKE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_REFUNDS_PAY\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_UNEARNED_CASH_REFI_PAYOFF\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_UNEARNED_CASH_TAKE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BANK_CF_ISSUE\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BANK_CF_ISSUE_REFI\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.BANK_CF_PRINCIPAL_TRANSFER\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_BANK_FEE_PAY\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.CF_BANK_INTEREST_PAY\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.PRINCIPAL_COLLECTED\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.INTEREST_COLLECTED\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.NSF_FEES_COLLECTED\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.LATE_FEES_COLLECTED\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.UNEARNED_CASH_COLLECTED\"}]}},{\"type\":\"operator\",\"operator\":\"*\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.GENERAL_REFUND_COLLECTED\"}]}},{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"DW_REF.FINANCIAL_STATEMENT_INDICATORS.IS_CREDIT\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"function\",\"functionName\":\"WHEN\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"=\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.TYPE\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"function\",\"functionName\":\"ROUND\",\"arguments\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"operator\",\"operator\":\"/\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.PAYMENT_TRANSACTIONS.AMOUNT_CENTS\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.CREDIT_LINE_ID\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.ID\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.STATUS\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.TYPE\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.ID\"},{\"type\":\"identifier\",\"name\":\"AVANT_BASIC.LOAN_TASKS.TYPE\"},{\"type\":\"identifier\",\"name\":\"METHOD\"},{\"type\":\"identifier\",\"name\":\"INSTALLMENT_ID\"},{\"type\":\"identifier\",\"name\":\"METHOD\"}]}},\"tableNode\":{\"type\":\"identifier\",\"name\":\"DW_TEMP_SWAP.TRANSACTIONS\"}}";
        CommandContext ctx = SqlCommandTestHelper.parseHive(command);
        CommandContext cctx = ctx.getChild(0);

        TenaliAstNode ast = cctx.getQueryContext().getTenaliAst();
        assertEquals(result, getTransformedString(ast));
    }

    @Test
    public void testSimpleSubQuery() throws Exception {
        String command = "use tenaliv2; select acc_id, tmp.id, dt, tmp.tag from (select account_id as acc_id, hist.id, tag, dt, hist.submit_time from rstore.query_hists hist where hist.dt>0) tmp";

        String result = "{\"type\":\"select\",\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"select\",\"where\":{\"type\":\"operator\",\"operator\":\">\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.DT\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS\"}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.TAG\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.DT\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.SUBMIT_TIME\"}]}}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.DT\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.TAG\"}]}}";
        CommandContext ctx = SqlCommandTestHelper.parseHive(command);
        CommandContext cctx = ctx.getChild(1);

        TenaliAstNode ast = cctx.getQueryContext().getTenaliAst();
        assertEquals(result, getTransformedString(ast));
    }


    @Test
    public void testSimpleNestedSubQuery() throws Exception {
        String command = "select account_id_id, id, dt2, tag from (select acc_id as account_id_id, tmp.id, dt as dt2, tmp.tag from (select account_id as acc_id, hist.id, tag, dt, hist.submit_time from rstore.query_hists hist where hist.dt>0) tmp) exp";

        String result = "{\"type\":\"select\",\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"select\",\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"select\",\"where\":{\"type\":\"operator\",\"operator\":\">\",\"operands\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.DT\"},{\"type\":\"literal\",\"value\":\"TENALI_LITERAL\"}]}},\"from\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS\"}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.TAG\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.DT\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.SUBMIT_TIME\"}]}}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.DT\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.TAG\"}]}}]},\"columns\":{\"type\":\"list\",\"operandlist\":[{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ACCOUNT_ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.ID\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.DT\"},{\"type\":\"identifier\",\"name\":\"RSTORE.QUERY_HISTS.TAG\"}]}}";
        CommandContext ctx = SqlCommandTestHelper.parseHive(command);
        CommandContext cctx = ctx.getChild(0);

        TenaliAstNode ast = cctx.getQueryContext().getTenaliAst();
        assertEquals(result, getTransformedString(ast));
    }

    @Test
    public void testErrorNode() throws Exception {
        String command = "select a, b, c from rstore.query_hists hist where ";

        String result = "{\"type\":\"error\",\"error\":\"ParseException, org.apache.hadoop.hive.ql.parse.ParseException: line 1:49 cannot recognize input near '<EOF>' '<EOF>' '<EOF>' in expression specification\"}";
        CommandContext ctx = SqlCommandTestHelper.parseHive(command);
        CommandContext cctx = ctx.getChild(0);

        Object ast = cctx.getQueryContext().getParseAst();
        assertEquals(result, getTransformedString(ast));
    }

}
